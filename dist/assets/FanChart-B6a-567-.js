import{C as F,r as d,R as C,L as G,j as S,G as O,g as J,a as Q,P as U,b as Z,c as tt,p as et,i as at}from"./index-CS_WGjnL.js";const V="label";function B(a,s){typeof a=="function"?a(s):a&&(a.current=s)}function nt(a,s){const n=a.options;n&&s&&Object.assign(n,s)}function K(a,s){a.labels=s}function $(a,s){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:V;const m=[];a.datasets=s.map(o=>{const c=a.datasets.find(f=>f[n]===o[n]);return!c||!o.data||m.includes(c)?{...o}:(m.push(c),Object.assign(c,o),c)})}function st(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:V;const n={labels:[],datasets:[]};return K(n,a.labels),$(n,a.datasets,s),n}function rt(a,s){const{height:n=150,width:m=300,redraw:o=!1,datasetIdKey:c,type:f,data:u,options:p,plugins:D=[],fallbackContent:P,updateMode:E,...M}=a,v=d.useRef(null),r=d.useRef(null),g=()=>{v.current&&(r.current=new F(v.current,{type:f,data:st(u,c),options:p&&{...p},plugins:D}),B(s,r.current))},y=()=>{B(s,null),r.current&&(r.current.destroy(),r.current=null)};return d.useEffect(()=>{!o&&r.current&&p&&nt(r.current,p)},[o,p]),d.useEffect(()=>{!o&&r.current&&K(r.current.config.data,u.labels)},[o,u.labels]),d.useEffect(()=>{!o&&r.current&&u.datasets&&$(r.current.config.data,u.datasets,c)},[o,u.datasets]),d.useEffect(()=>{r.current&&(o?(y(),setTimeout(g)):r.current.update(E))},[o,p,u.labels,u.datasets,E]),d.useEffect(()=>{r.current&&(y(),setTimeout(g))},[f]),d.useEffect(()=>(g(),()=>y()),[]),C.createElement("canvas",{ref:v,role:"img",height:n,width:m,...M},P)}const ot=d.forwardRef(rt);function lt(a,s){return F.register(s),d.forwardRef((n,m)=>C.createElement(ot,{...n,ref:m,type:a}))}const it=lt("line",G);F.register(G,Q,U,Z,tt,et,at);const ct="rgba(203,161,53,0.28)",W="rgba(203,161,53,0.12)",j="rgba(255,255,255,0.07)";function dt({data:a,artifact:s}){const n=a??s;if(!n||!Array.isArray(n.median_path)||!n.median_path.length||!n.bands)return S.jsx("div",{className:"text-xs opacity-70",children:"Run a simulation to view."});const{symbol:m,horizon_days:o,median_path:c,bands:f}=n,u=c.map(([t])=>`D${t}`),p=c.map(([,t])=>t),D=f.p80_low.map(([,t])=>t),P=f.p80_high.map(([,t])=>t),E=f.p95_low.map(([,t])=>t),M=f.p95_high.map(([,t])=>t),[v,r]=C.useState(null),[g,y]=C.useState(null),N=C.useRef(null),z=(t,e,l)=>Math.max(e,Math.min(l,t)),X={labels:u,datasets:[{label:"95% band",data:M,borderWidth:0,backgroundColor:j,fill:{target:2,above:j,below:j},pointRadius:0},{label:"80% band",data:P,borderWidth:0,backgroundColor:W,fill:{target:3,above:W,below:W},pointRadius:0},{label:"_95_low",data:E,borderWidth:0,pointRadius:0},{label:"_80_low",data:D,borderWidth:0,pointRadius:0},{label:"MedianGlow",data:p,borderColor:ct,borderWidth:6,pointRadius:0,tension:.16},{label:"Median",data:p,borderColor:O,borderWidth:2,pointRadius:0,tension:.16}]},Y={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!1},tooltip:{enabled:!0}},scales:{x:{grid:{display:!1},ticks:{maxRotation:0},title:{display:!0,text:"Days",color:"#C7C9D1"}},y:{title:{display:!0,text:"Price",color:"#C7C9D1"}}},onHover:(t,e,l)=>{const i=l.scales,L=i==null?void 0:i.x,k=i==null?void 0:i.y;if(!L||!k)return;const x=J(t.native??t,l),R=L.getValueForPixel(x.x),h=k.getValueForPixel(x.y);if(R==null||h==null||!Number.isFinite(R)||!Number.isFinite(h)){r(null),y(null);return}const b=z(Math.round(Number(R)),0,u.length-1),w=D[b],_=P[b],T=E[b],A=M[b];let H=null;w!=null&&_!=null&&h>=w&&h<=_?H="p80":T!=null&&A!=null&&h>=T&&h<=A&&(H="p95"),r(b),y(H);const I=l.canvas;I&&(I.style.cursor="crosshair")}},q={id:"fanHoverOverlay",afterDraw:t=>{if(v==null)return;const{ctx:e,chartArea:l,scales:i}=t,L=i==null?void 0:i.x,k=i==null?void 0:i.y;if(!L||!k)return;const x=L.getPixelForValue(v);if(e.save(),e.strokeStyle="rgba(148,163,184,0.45)",e.lineWidth=1,e.beginPath(),e.moveTo(x,l.top),e.lineTo(x,l.bottom),e.stroke(),g){const R=g==="p80"?"80% band":"95% band",h=6,b=Math.min(Math.max(x+8,l.left+4),l.right-104),w=l.top+8;e.font="12px ui-sans-serif, system-ui, -apple-system",e.fillStyle="rgba(0,0,0,0.92)";const _=e.measureText(R).width+h*2;e.fillRect(b,w,_,18),e.strokeStyle=g==="p80"?O:"rgba(255,255,255,0.28)",e.strokeRect(b,w,_,18),e.fillStyle="#E5E7EB",e.fillText(R,b+h,w+13)}e.restore()}};return C.useEffect(()=>{var l;const t=(l=N.current)==null?void 0:l.canvas;if(!t)return;const e=()=>{r(null),y(null),t.style.cursor="default"};return t.addEventListener("mouseleave",e),()=>t.removeEventListener("mouseleave",e)},[]),S.jsx("div",{"data-chart":"fan",className:"relative w-full overflow-hidden",style:{height:360},children:S.jsx(it,{ref:N,data:X,options:Y,plugins:[q],role:"img","aria-label":`Fan chart for ${m} over ${o} days with median, 80% and 95% bands`})})}export{dt as default};
