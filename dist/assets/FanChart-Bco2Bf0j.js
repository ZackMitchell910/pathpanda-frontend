import{r as w,C as G,j as J}from"./index-BWcUjsGU.js";const $="rgba(255,255,255,0.08)",H="rgba(255,255,255,0.38)",K="rgba(255,255,255,0.07)",U="rgba(255,255,255,0.15)",X="rgba(250,204,21,0.18)",j="#E5E7EB",f="#FACC15",z="#38BDF8";function Q({artifact:n}){const I=w.useRef(null),M=w.useRef(null),O=w.useMemo(()=>{var k,d,e,o,F,N;const P=t=>Array.isArray(t)?t.filter(s=>Array.isArray(s)&&s.length>=2&&Number.isFinite(s[0])&&Number.isFinite(s[1])):[],m=P(n==null?void 0:n.median_path),p=m.map(([t])=>t),y=m.map(([,t])=>t),B=(t,s)=>{if(!p.length)return[];const u=P(t);if(!u.length)return s&&s.length===p.length?s:p.map((h,r)=>Number.isFinite(y[r])?y[r]:0);const g=new Map;return u.forEach(([h,r])=>{Number.isFinite(h)&&Number.isFinite(r)&&g.set(h,r)}),p.map((h,r)=>{const b=g.get(h);if(Number.isFinite(b))return b;if(s&&Number.isFinite(s[r]))return s[r];const l=y[r];return Number.isFinite(l)?l:0})},a=(t,s)=>{if(!p.length)return[];const u=P(t);if(!u.length){const r=s&&s.length?s:y;return p.map((b,l)=>Number.isFinite(r[l])?r[l]:0)}const g=new Map;u.forEach(([r,b])=>{Number.isFinite(r)&&Number.isFinite(b)&&g.set(r,b)});const h=s&&s.length===p.length?s:y;return p.map((r,b)=>{const l=g.get(r);if(Number.isFinite(l))return l;const i=h[b];return Number.isFinite(i)?i:0})},_=a((k=n==null?void 0:n.bands)==null?void 0:k.p80_low),S=a((d=n==null?void 0:n.bands)==null?void 0:d.p80_high),R=a((e=n==null?void 0:n.bands)==null?void 0:e.p95_low),D=a((o=n==null?void 0:n.bands)==null?void 0:o.p95_high),v=B(n==null?void 0:n.map_path,y),L=v.some((t,s)=>Number.isFinite(t)&&t!==y[s]),c=a((F=n==null?void 0:n.mode_band)==null?void 0:F.p68_low,_),A=a((N=n==null?void 0:n.mode_band)==null?void 0:N.p68_high,S),T=c.length&&A.length&&c.some((t,s)=>t!==_[s])&&A.some((t,s)=>t!==S[s]),V=Number.isFinite(n==null?void 0:n.most_likely_price)?Number(n==null?void 0:n.most_likely_price):null,E=(()=>{var b;const t=new Set(p),s=[],u=l=>{if(l){if(typeof l=="number"&&Number.isFinite(l))s.push({day:l});else if(typeof l=="object"){const i=l,x=i.day??i.day_index??i.t??i.x;typeof x=="number"&&Number.isFinite(x)&&s.push({day:x,label:typeof i.label=="string"?i.label:typeof i.name=="string"?i.name:void 0,severity:typeof i.severity=="number"?i.severity:void 0,type:typeof i.type=="string"?i.type:void 0})}}},g=(n==null?void 0:n.jump_markers)??(n==null?void 0:n.event_markers)??[];Array.isArray(g)&&g.forEach(u);const h=(n==null?void 0:n.scheduled_events)??[];Array.isArray(h)&&h.forEach(u);const r=(b=n==null?void 0:n.diagnostics)==null?void 0:b.scheduler;return Array.isArray(r)&&r.forEach(l=>{typeof(l==null?void 0:l.day)=="number"&&u(l)}),s.filter(l=>t.has(Math.round(l.day)))})();return{xs:p,median:y,p80L:_,p80H:S,p95L:R,p95H:D,mapPath:v,hasMap:L,modeBandLow:c,modeBandHigh:A,hasModeBand:T,mostLikely:V,eventMarkers:E}},[n]);return w.useEffect(()=>{var k;const P=(k=I.current)==null?void 0:k.getContext("2d");if(!P)return;M.current&&(M.current.destroy(),M.current=null);const{xs:m,median:p,p80L:y,p80H:B,p95L:a,p95H:_,mapPath:S,hasMap:R,modeBandLow:D,modeBandHigh:v,hasModeBand:L,mostLikely:c,eventMarkers:A}=O,T={id:"fanBands",beforeDatasetsDraw(d){var h;const{chartArea:e,ctx:o}=d,{top:F,bottom:N}=e,t=d.scales.x,s=d.scales.y;if(!t||!s||!m.length)return;function u(r,b,l){o.save(),o.beginPath(),m.forEach((i,x)=>{const C=t.getPixelForValue(i),W=s.getPixelForValue(b[x]);x===0?o.moveTo(C,W):o.lineTo(C,W)});for(let i=m.length-1;i>=0;i--){const x=t.getPixelForValue(m[i]),C=s.getPixelForValue(r[i]);o.lineTo(x,C)}o.closePath(),o.fillStyle=l,o.fill(),o.restore()}u(a,_,K),u(y,B,U),L&&u(D,v,X);const g=(h=d.getActiveElements)==null?void 0:h.call(d)[0];if(g){const r=d.scales.x.getPixelForValue(g.index);o.save(),o.strokeStyle="rgba(255,255,255,0.25)",o.lineWidth=1,o.beginPath(),o.moveTo(r,F),o.lineTo(r,N),o.stroke(),o.restore()}},afterDatasetsDraw(d){const{ctx:e,chartArea:o}=d,F=d.scales.x,N=d.scales.y;if(c!==null&&m.length){const t=m[m.length-1],s=F.getPixelForValue(t),u=N.getPixelForValue(c);e.save(),e.fillStyle=f,e.strokeStyle="#0A0A0A",e.lineWidth=1.5,e.beginPath(),e.arc(s,u,4,0,Math.PI*2),e.fill(),e.stroke(),e.font="11px Inter, system-ui, sans-serif",e.textAlign="left",e.textBaseline="bottom";const g=m.length&&Number.isFinite(p[0])?(c/(p[0]||1)-1)*100:null,h=`Mode $${c.toFixed(2)}${Number.isFinite(g??NaN)?` (${g.toFixed(1)}%)`:""}`;e.fillStyle="rgba(250,204,21,0.9)",e.fillText(h,s+8,u-6),e.restore()}A.length&&(e.save(),e.textAlign="center",e.textBaseline="top",e.font="10px Inter, system-ui, sans-serif",A.forEach(t=>{const s=F.getPixelForValue(t.day);s<o.left-10||s>o.right+10||(e.strokeStyle=z,e.lineWidth=1,e.beginPath(),e.moveTo(s,o.top),e.lineTo(s,o.bottom),e.stroke(),e.fillStyle="#0A0A0A",e.beginPath(),e.arc(s,o.top+10,6,0,Math.PI*2),e.fill(),e.strokeStyle=z,e.lineWidth=2,e.beginPath(),e.arc(s,o.top+10,6,0,Math.PI*2),e.stroke(),t.label&&(e.fillStyle="rgba(255,255,255,0.8)",e.fillText(t.label,s,o.top+20)))}),e.restore())}},V={animation:!1,responsive:!0,maintainAspectRatio:!1,scales:{x:{ticks:{color:H,autoSkip:!0,maxTicksLimit:8},grid:{color:$}},y:{ticks:{color:H},grid:{color:$}}},plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(17,17,17,0.95)",titleColor:"#fff",bodyColor:"#e5e7eb",borderColor:"rgba(255,255,255,0.12)",borderWidth:1,callbacks:{title:d=>{var e,o;return`Day ${((o=(e=d==null?void 0:d[0])==null?void 0:e.parsed)==null?void 0:o.x)??""}`},label:d=>{var e,o;return` ${d.dataset.label}: ${(o=(e=d.parsed.y)==null?void 0:e.toFixed)==null?void 0:o.call(e,2)}`}}}},elements:{line:{tension:.2}}},E=new G(P,{type:"line",data:{labels:m,datasets:[{label:"Median",data:p,borderColor:j,backgroundColor:j,borderWidth:2,pointRadius:0},...R?[{label:"MAP Path",data:S,borderColor:f,backgroundColor:f,borderWidth:1.5,pointRadius:0,borderDash:[4,3]}]:[]]},options:V,plugins:[T]});return M.current=E,()=>{E.destroy(),M.current=null}},[n]),J.jsx("canvas",{ref:I,className:"w-full h-full"})}export{Q as default};
