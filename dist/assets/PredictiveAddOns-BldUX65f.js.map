{"version":3,"file":"PredictiveAddOns-BldUX65f.js","sources":["../../src/components/PredictiveAddOns.tsx"],"sourcesContent":["// src/components/PredictiveAddOns.tsx\r\nimport React from \"react\";\r\nimport \"chart.js/auto\";\r\nimport type { ChartData, ChartOptions, ActiveElement } from \"chart.js\";\r\nimport { Line, Bar, Chart as MixedChart } from \"react-chartjs-2\";\r\nimport { Card } from \"./ui/Card\";\r\nimport { PP_COLORS } from \"../theme/chartTheme\";\r\nimport { Chart as ChartComponent } from \"react-chartjs-2\";\r\nexport interface Artifact {\r\n  symbol: string;\r\n  horizon_days: number;\r\n  median_path: [number, number][];\r\n  bands: Record<string, [number, number][]>;\r\n  prob_up_end?: number;\r\n  drivers?: { name: string; weight: number }[];\r\n}\r\n\r\nconst makeTimeLabels = (artifact: Artifact): string[] =>\r\n  artifact.median_path.map(([t]) => `D${t}`);\r\n\r\n/* ----------------------- TerminalDistribution ---------------------- */\r\n\r\ntype Ptiles = { p05?: number | null; p50?: number | null; p95?: number | null };\r\n\r\nexport const TerminalDistribution: React.FC<{\r\n  pathsTerminal: number[];\r\n  ptiles?: Ptiles;\r\n}> = ({ pathsTerminal, ptiles }) => {\r\n  if (!pathsTerminal?.length) {\r\n    return <div className=\"text-xs text-zinc-400\">No terminal data.</div>;\r\n  }\r\n\r\n  // Histogram (PDF) + CDF\r\n  const values = [...pathsTerminal].sort((a, b) => a - b);\r\n  const n = values.length;\r\n  const vMin = values[0];\r\n  const vMax = values[n - 1];\r\n\r\n  const nBins = Math.min(60, Math.max(20, Math.floor(Math.sqrt(n))));\r\n  const binWidth = (vMax - vMin) / nBins || 1;\r\n\r\n  const counts = new Array(nBins).fill(0);\r\n  for (const v of values) {\r\n    let idx = Math.floor((v - vMin) / binWidth);\r\n    if (idx >= nBins) idx = nBins - 1;\r\n    if (idx < 0) idx = 0;\r\n    counts[idx] += 1;\r\n  }\r\n\r\n  const pdf = counts.map((c) => c / (n * binWidth));\r\n  const cdf: number[] = [];\r\n  let running = 0;\r\n  for (let i = 0; i < nBins; i++) {\r\n    running += counts[i];\r\n    cdf.push(running / n);\r\n  }\r\n  // --- shared hover presets ---\r\n  const HOVER_POINTS = {\r\n    pointRadius: 0,          // hide points until hovered\r\n    pointHoverRadius: 5,     // visible pin-dot size\r\n    pointHitRadius: 10,      // easier to hover\r\n    pointHoverBorderWidth: 2,\r\n  };\r\n\r\n  const SHARED_HOVER_OPTIONS = {\r\n    interaction: { mode: \"index\" as const, intersect: false },\r\n    plugins: {\r\n      tooltip: {\r\n        mode: \"index\" as const,\r\n        intersect: false,\r\n        callbacks: {\r\n          // unified label formatting (price if it looks like a price axis)\r\n          label: (ctx: any) => {\r\n            const label = ctx.dataset?.label ?? \"\";\r\n            const y = ctx.parsed?.y;\r\n            if (y == null) return label;\r\n            // if the y-range looks like a dollar axis, format as price\r\n            const asPrice =\r\n              ctx.chart?.scales?.y?.options?.title?.text?.toLowerCase?.().includes(\"price\");\r\n            const formatted = asPrice\r\n              ? `$${Number(y).toLocaleString(undefined, { maximumFractionDigits: 2 })}`\r\n              : `${Number(y).toLocaleString(undefined, { maximumFractionDigits: 4 })}`;\r\n            return `${label}: ${formatted}`;\r\n          },\r\n        },\r\n      },\r\n      legend: { display: true },\r\n    },\r\n    elements: { point: { radius: 0 } }, // default: no points unless hovered\r\n  };\r\n\r\n\r\n  const labels = Array.from({ length: nBins }, (_, i) =>\r\n    (vMin + (i + 0.5) * binWidth).toFixed(2)\r\n  );\r\n\r\n  const data: ChartData<\"bar\" | \"line\", number[], string> = {\r\n    labels,\r\n    datasets: [\r\n      {\r\n        type: \"bar\",\r\n        label: \"PDF\",\r\n        data: pdf,\r\n        yAxisID: \"y\",\r\n        borderWidth: 0,\r\n        backgroundColor: \"rgba(99,102,241,0.45)\",\r\n        barPercentage: 1.0,\r\n        categoryPercentage: 1.0,\r\n      },\r\n      {\r\n        type: \"line\",\r\n        label: \"CDF\",\r\n        data: cdf,\r\n        yAxisID: \"y1\",\r\n        borderColor: \"#0EA5E9\",\r\n        borderWidth: 2,\r\n        pointRadius: 0,\r\n        tension: 0.15,\r\n      },\r\n    ],\r\n  };\r\n\r\n  const options: ChartOptions<\"bar\" | \"line\"> = {\r\n    responsive: true,\r\n    maintainAspectRatio: false,\r\n    interaction: { mode: \"index\", intersect: false },\r\n    plugins: { legend: { display: true }, tooltip: { enabled: true } },\r\n    scales: {\r\n      x: {\r\n        ticks: { maxRotation: 0, autoSkip: true },\r\n        title: { display: true, text: \"Price\" },\r\n        grid: { display: false },\r\n      },\r\n      y: {\r\n        beginAtZero: true,\r\n        title: { display: true, text: \"PDF\" },\r\n        grid: { color: \"rgba(148,163,184,0.15)\" },\r\n      },\r\n      y1: {\r\n        beginAtZero: true,\r\n        max: 1,\r\n        position: \"right\",\r\n        title: { display: true, text: \"CDF\" },\r\n        grid: { display: false },\r\n      },\r\n    },\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative w-full\" style={{ height: 280 }}>\r\n      <ChartComponent type=\"bar\" data={data} options={options} />\r\n      <div className=\"text-[11px] mt-2 grid grid-cols-3 gap-2 opacity-80\">\r\n        {ptiles?.p05 != null && <div>p05: {ptiles.p05.toFixed(2)}</div>}\r\n        {ptiles?.p50 != null && <div>p50: {ptiles.p50.toFixed(2)}</div>}\r\n        {ptiles?.p95 != null && <div>p95: {ptiles.p95.toFixed(2)}</div>}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n/* -------------------------- DriversWaterfall ------------------------ */\r\nexport const DriversWaterfall: React.FC<{\r\n  drivers?: { name: string; weight: number }[];\r\n}> = ({ drivers }) => {\r\n  const rows = Array.isArray(drivers) ? drivers : [];\r\n  if (!rows.length) return <div className=\"text-xs opacity-70\">No drivers yet.</div>;\r\n\r\n  const labels = rows.map((d) => String(d?.name ?? \"\"));\r\n  const dataVals = rows.map((d) => (Number.isFinite(d?.weight) ? Number(d.weight) : 0));\r\n\r\n  const [explanation, setExplanation] = React.useState<string | null>(null);\r\n  const fetchExplanation = async (driver: string) =>\r\n    `Explanation for ${driver}: Influences price due to market trends.`;\r\n  const handleClick = async (name: string) => setExplanation(await fetchExplanation(name));\r\n\r\n  const chartData: ChartData<\"bar\"> = {\r\n    labels,\r\n    datasets: [\r\n      {\r\n        label: \"Driver Impact\",\r\n        data: dataVals,\r\n        backgroundColor: dataVals.map((w) => (w >= 0 ? PP_COLORS.bull : PP_COLORS.bear)),\r\n        borderWidth: 0,\r\n      },\r\n    ],\r\n  };\r\n\r\n  const options: ChartOptions<\"bar\"> = {\r\n    responsive: true,\r\n    indexAxis: \"y\",\r\n    plugins: { legend: { display: false }, tooltip: { enabled: true } },\r\n    scales: {\r\n      x: { title: { display: true, text: \"Impact\" } },\r\n      y: { title: { display: true, text: \"Drivers\" } },\r\n    },\r\n    onClick: (_e, elements) => {\r\n      const el = (elements?.[0] as ActiveElement | undefined) || undefined;\r\n      if (el?.index != null) handleClick(labels[el.index]);\r\n    },\r\n  };\r\n\r\n  return (\r\n    <div data-chart=\"drivers\">\r\n      <Bar data={chartData} options={options} />\r\n      {explanation && <div className=\"text-sm mt-2\">{explanation}</div>}\r\n    </div>\r\n  );\r\n};\r\n\r\n/* ----------------------------- ScenarioTiles ----------------------------- */\r\nexport const ScenarioTiles: React.FC<{\r\n  artifact?: Artifact;\r\n  reps?: { label: string; path: [number, number][] }[];\r\n}> = ({ artifact, reps }) => {\r\n  const labels =\r\n    Array.isArray(artifact?.median_path) && artifact!.median_path.length\r\n      ? artifact!.median_path.map(([t]) => `D${t}`)\r\n      : [];\r\n\r\n  const datasets: ChartData<\"line\">[\"datasets\"] = [];\r\n\r\n  if (labels.length && Array.isArray(artifact?.median_path)) {\r\n    datasets.push({\r\n      label: \"Median\",\r\n      data: artifact!.median_path.map(([, y]) => y),\r\n      borderColor: PP_COLORS.median,\r\n      borderWidth: 2,\r\n      pointRadius: 0,\r\n    });\r\n  }\r\n\r\n  if (Array.isArray(reps) && reps.length) {\r\n    datasets.push(\r\n      ...reps.map((r) => ({\r\n        label: r.label,\r\n        data: (Array.isArray(r.path) ? r.path : []).map(([, y]) => y),\r\n        borderColor: r.label.toLowerCase().includes(\"bull\") ? PP_COLORS.bull : PP_COLORS.bear,\r\n        borderWidth: 2,\r\n        pointRadius: 0,\r\n      }))\r\n    );\r\n  }\r\n\r\n  if (!labels.length || !datasets.length) {\r\n    return <div className=\"text-xs opacity-70\">No scenarios computed.</div>;\r\n  }\r\n\r\n  const data: ChartData<\"line\"> = { labels, datasets };\r\n  const options: ChartOptions<\"line\"> = {\r\n    responsive: true,\r\n    maintainAspectRatio: false,\r\n    plugins: { legend: { display: true }, tooltip: { enabled: true } },\r\n  };\r\n\r\n  return (\r\n    <div data-chart=\"scenarios\">\r\n      <Line data={data} options={options} />\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n/* ----------------------------- TargetLadder ------------------------------ */\r\n// Keep in src/components/PredictiveAddOns.tsx (or its own file) â€“ full replacement\r\nexport function TargetLadder({\r\n  probs,\r\n}: {\r\n  probs: Array<{ target?: string; prob?: number; label?: string; p?: number }>;\r\n}) {\r\n  const items = (probs || [])\r\n    .map((row) => ({\r\n      target: (row.target ?? row.label ?? \"\").toString(),\r\n      prob: Number.isFinite(row.prob ?? row.p) ? Number(row.prob ?? row.p) : NaN,\r\n    }))\r\n    .filter((r) => r.target && Number.isFinite(r.prob));\r\n\r\n  return (\r\n    <div className=\"rounded-lg border border-[#273141] bg-[#0E141C] p-3\">\r\n      <div className=\"text-sm font-semibold mb-2\">Target Probabilities</div>\r\n      <ul className=\"space-y-1\">\r\n        {items.map((p, i) => (\r\n          <li key={i} className=\"flex items-center justify-between text-sm\">\r\n            <span className=\"text-zinc-300\">{p.target}</span>\r\n            <span className=\"font-mono\">{(p.prob * 100).toFixed(1)}%</span>\r\n          </li>\r\n        ))}\r\n        {items.length === 0 && (\r\n          <li className=\"text-xs text-zinc-400\">No target probabilities.</li>\r\n        )}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n\r\n\r\n/* ------------------------- HitProbabilityRibbon ------------------------- */\r\ntype Bands =\r\n  | {\r\n      p50: [number, number][];\r\n      p80_low: [number, number][];\r\n      p80_high: [number, number][];\r\n      p95_low: [number, number][];\r\n      p95_high: [number, number][];\r\n    }\r\n  | undefined;\r\n\r\nexport function HitProbabilityRibbon({\r\n  artifact,\r\n  thresholds = [-0.05, 0, 0.05, 0.1],\r\n  S0,\r\n  pathMatrixAbove,\r\n}: {\r\n  artifact?: {\r\n    symbol?: string;\r\n    horizon_days?: number;\r\n    median_path?: [number, number][];\r\n    hit_probs?: { thresholds_abs?: number[]; probs_by_day?: number[][] };\r\n  };\r\n  thresholds?: number[];\r\n  S0?: number;\r\n  pathMatrixAbove?: (tIndex: number, thresholdAbs: number) => number;\r\n}) {\r\n  const probsFromBackend = artifact?.hit_probs?.probs_by_day;\r\n  const thresholdsAbsFromBackend = artifact?.hit_probs?.thresholds_abs;\r\n\r\n  const T =\r\n    probsFromBackend?.[0]?.length ??\r\n    (Number.isFinite(artifact?.horizon_days) ? (artifact!.horizon_days as number) + 1 : 0);\r\n\r\n  if (!T) {\r\n    return <div className=\"text-xs opacity-70\">Run a simulation to see hit probabilities.</div>;\r\n  }\r\n\r\n  const labels = Array.from({ length: T }, (_, i) => `D${i}`);\r\n  const s0 =\r\n    typeof S0 === \"number\"\r\n      ? S0\r\n      : Array.isArray(artifact?.median_path) && artifact!.median_path.length\r\n      ? artifact!.median_path[0][1]\r\n      : undefined;\r\n\r\n  const thresholdsPct: number[] =\r\n    thresholdsAbsFromBackend && thresholdsAbsFromBackend.length && typeof s0 === \"number\"\r\n      ? thresholdsAbsFromBackend.map((abs) => abs / s0 - 1)\r\n      : thresholds;\r\n\r\n  const safePathMatrixAbove = pathMatrixAbove ?? ((_t: number, _thrAbs: number) => 0);\r\n\r\n  const probsByDay: number[][] =\r\n    probsFromBackend && probsFromBackend.length\r\n      ? probsFromBackend\r\n      : typeof s0 === \"number\"\r\n      ? thresholdsPct.map((th) =>\r\n          Array.from({ length: T }, (_, t) => safePathMatrixAbove(t, (1 + th) * s0))\r\n        )\r\n      : thresholdsPct.map(() => Array.from({ length: T }, () => 0));\r\n\r\n  const palette = [\"#34D399\", \"#22D3EE\", \"#60A5FA\", \"#FBBF24\"];\r\n  const datasets = probsByDay.map((series, i) => ({\r\n    label: `Above ${Math.round(thresholdsPct[i] * 100)}%`,\r\n    data: series,\r\n    borderColor: palette[i % palette.length],\r\n    borderWidth: 2,\r\n    pointRadius: 0,\r\n    tension: 0.15,\r\n  }));\r\n\r\n  const data: ChartData<\"line\"> = { labels, datasets };\r\n  const options: ChartOptions<\"line\"> = {\r\n    responsive: true,\r\n    maintainAspectRatio: false,\r\n    scales: {\r\n      x: { grid: { display: false }, ticks: { maxRotation: 0 }, title: { display: true, text: \"Days\" } },\r\n      y: { min: 0, max: 1, title: { display: true, text: \"Probability\" } },\r\n    },\r\n    plugins: { legend: { display: true }, tooltip: { enabled: true } },\r\n    elements: { line: { fill: false } },\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative w-full\" style={{ height: 320 }}>\r\n      <Line data={data} options={options} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default HitProbabilityRibbon;\r\n"],"names":["TerminalDistribution","pathsTerminal","ptiles","jsx","values","a","b","n","vMin","vMax","nBins","binWidth","counts","v","idx","pdf","c","cdf","running","i","data","_","options","jsxs","ChartComponent","DriversWaterfall","drivers","rows","labels","d","dataVals","explanation","setExplanation","React","fetchExplanation","driver","handleClick","name","chartData","w","PP_COLORS","_e","elements","el","Bar","ScenarioTiles","artifact","reps","t","datasets","y","r","Line","TargetLadder","probs","items","row","p","HitProbabilityRibbon","thresholds","S0","pathMatrixAbove","probsFromBackend","_a","thresholdsAbsFromBackend","_b","T","_c","s0","thresholdsPct","abs","safePathMatrixAbove","_t","_thrAbs","probsByDay","th","palette","series"],"mappings":"4GAwBO,MAAMA,EAGR,CAAC,CAAE,cAAAC,EAAe,OAAAC,KAAa,CAClC,GAAI,EAACD,GAAA,MAAAA,EAAe,QAClB,OAAOE,EAAAA,IAAC,MAAA,CAAI,UAAU,wBAAwB,SAAA,oBAAiB,EAIjE,MAAMC,EAAS,CAAC,GAAGH,CAAa,EAAE,KAAK,CAACI,EAAGC,IAAMD,EAAIC,CAAC,EAChDC,EAAIH,EAAO,OACXI,EAAOJ,EAAO,CAAC,EACfK,EAAOL,EAAOG,EAAI,CAAC,EAEnBG,EAAQ,KAAK,IAAI,GAAI,KAAK,IAAI,GAAI,KAAK,MAAM,KAAK,KAAKH,CAAC,CAAC,CAAC,CAAC,EAC3DI,GAAYF,EAAOD,GAAQE,GAAS,EAEpCE,EAAS,IAAI,MAAMF,CAAK,EAAE,KAAK,CAAC,EACtC,UAAWG,KAAKT,EAAQ,CACtB,IAAIU,EAAM,KAAK,OAAOD,EAAIL,GAAQG,CAAQ,EACtCG,GAAOJ,IAAOI,EAAMJ,EAAQ,GAC5BI,EAAM,IAAGA,EAAM,GACnBF,EAAOE,CAAG,GAAK,CACjB,CAEA,MAAMC,EAAMH,EAAO,IAAKI,GAAMA,GAAKT,EAAII,EAAS,EAC1CM,EAAgB,CAAA,EACtB,IAAIC,EAAU,EACd,QAASC,EAAI,EAAGA,EAAIT,EAAOS,IACzBD,GAAWN,EAAOO,CAAC,EACnBF,EAAI,KAAKC,EAAUX,CAAC,EA0CtB,MAAMa,EAAoD,CACxD,OALa,MAAM,KAAK,CAAE,OAAQV,CAAA,EAAS,CAACW,EAAGF,KAC9CX,GAAQW,EAAI,IAAOR,GAAU,QAAQ,CAAC,CAAA,EAKvC,SAAU,CACR,CACE,KAAM,MACN,MAAO,MACP,KAAMI,EACN,QAAS,IACT,YAAa,EACb,gBAAiB,wBACjB,cAAe,EACf,mBAAoB,CAAA,EAEtB,CACE,KAAM,OACN,MAAO,MACP,KAAME,EACN,QAAS,KACT,YAAa,UACb,YAAa,EACb,YAAa,EACb,QAAS,GAAA,CACX,CACF,EAGIK,EAAwC,CAC5C,WAAY,GACZ,oBAAqB,GACrB,YAAa,CAAE,KAAM,QAAS,UAAW,EAAA,EACzC,QAAS,CAAE,OAAQ,CAAE,QAAS,EAAA,EAAQ,QAAS,CAAE,QAAS,GAAK,EAC/D,OAAQ,CACN,EAAG,CACD,MAAO,CAAE,YAAa,EAAG,SAAU,EAAA,EACnC,MAAO,CAAE,QAAS,GAAM,KAAM,OAAA,EAC9B,KAAM,CAAE,QAAS,EAAA,CAAM,EAEzB,EAAG,CACD,YAAa,GACb,MAAO,CAAE,QAAS,GAAM,KAAM,KAAA,EAC9B,KAAM,CAAE,MAAO,wBAAA,CAAyB,EAE1C,GAAI,CACF,YAAa,GACb,IAAK,EACL,SAAU,QACV,MAAO,CAAE,QAAS,GAAM,KAAM,KAAA,EAC9B,KAAM,CAAE,QAAS,EAAA,CAAM,CACzB,CACF,EAGF,OACEC,EAAAA,KAAC,OAAI,UAAU,kBAAkB,MAAO,CAAE,OAAQ,KAChD,SAAA,CAAApB,EAAAA,IAACqB,EAAA,CAAe,KAAK,MAAM,KAAAJ,EAAY,QAAAE,EAAkB,EACzDC,EAAAA,KAAC,MAAA,CAAI,UAAU,qDACZ,SAAA,EAAArB,GAAA,YAAAA,EAAQ,MAAO,MAAQqB,EAAAA,KAAC,MAAA,CAAI,SAAA,CAAA,QAAMrB,EAAO,IAAI,QAAQ,CAAC,CAAA,EAAE,GACxDA,GAAA,YAAAA,EAAQ,MAAO,MAAQqB,EAAAA,KAAC,MAAA,CAAI,SAAA,CAAA,QAAMrB,EAAO,IAAI,QAAQ,CAAC,CAAA,EAAE,GACxDA,GAAA,YAAAA,EAAQ,MAAO,MAAQqB,EAAAA,KAAC,MAAA,CAAI,SAAA,CAAA,QAAMrB,EAAO,IAAI,QAAQ,CAAC,CAAA,CAAA,CAAE,CAAA,CAAA,CAC3D,CAAA,EACF,CAEJ,EAEauB,EAER,CAAC,CAAE,QAAAC,KAAc,CACpB,MAAMC,EAAO,MAAM,QAAQD,CAAO,EAAIA,EAAU,CAAA,EAChD,GAAI,CAACC,EAAK,OAAQ,aAAQ,MAAA,CAAI,UAAU,qBAAqB,SAAA,kBAAe,EAE5E,MAAMC,EAASD,EAAK,IAAKE,GAAM,QAAOA,GAAA,YAAAA,EAAG,OAAQ,EAAE,CAAC,EAC9CC,EAAWH,EAAK,IAAKE,GAAO,OAAO,SAASA,GAAA,YAAAA,EAAG,MAAM,EAAI,OAAOA,EAAE,MAAM,EAAI,CAAE,EAE9E,CAACE,EAAaC,CAAc,EAAIC,EAAM,SAAwB,IAAI,EAClEC,EAAmB,MAAOC,GAC9B,mBAAmBA,CAAM,2CACrBC,EAAc,MAAOC,GAAiBL,EAAe,MAAME,EAAiBG,CAAI,CAAC,EAEjFC,EAA8B,CAClC,OAAAV,EACA,SAAU,CACR,CACE,MAAO,gBACP,KAAME,EACN,gBAAiBA,EAAS,IAAKS,GAAOA,GAAK,EAAIC,EAAU,KAAOA,EAAU,IAAK,EAC/E,YAAa,CAAA,CACf,CACF,EAGIlB,EAA+B,CACnC,WAAY,GACZ,UAAW,IACX,QAAS,CAAE,OAAQ,CAAE,QAAS,EAAA,EAAS,QAAS,CAAE,QAAS,GAAK,EAChE,OAAQ,CACN,EAAG,CAAE,MAAO,CAAE,QAAS,GAAM,KAAM,SAAS,EAC5C,EAAG,CAAE,MAAO,CAAE,QAAS,GAAM,KAAM,UAAU,CAAE,EAEjD,QAAS,CAACmB,EAAIC,IAAa,CACzB,MAAMC,GAAMD,GAAA,YAAAA,EAAW,KAAoC,QACvDC,GAAA,YAAAA,EAAI,QAAS,QAAkBf,EAAOe,EAAG,KAAK,CAAC,CACrD,CAAA,EAGF,OACEpB,EAAAA,KAAC,MAAA,CAAI,aAAW,UACd,SAAA,CAAApB,EAAAA,IAACyC,EAAA,CAAI,KAAMN,EAAW,QAAAhB,CAAA,CAAkB,EACvCS,GAAe5B,EAAAA,IAAC,MAAA,CAAI,UAAU,eAAgB,SAAA4B,CAAA,CAAY,CAAA,EAC7D,CAEJ,EAGac,EAGR,CAAC,CAAE,SAAAC,EAAU,KAAAC,KAAW,CAC3B,MAAMnB,EACJ,MAAM,QAAQkB,GAAA,YAAAA,EAAU,WAAW,GAAKA,EAAU,YAAY,OAC1DA,EAAU,YAAY,IAAI,CAAC,CAACE,CAAC,IAAM,IAAIA,CAAC,EAAE,EAC1C,CAAA,EAEAC,EAA0C,CAAA,EAwBhD,GAtBIrB,EAAO,QAAU,MAAM,QAAQkB,GAAA,YAAAA,EAAU,WAAW,GACtDG,EAAS,KAAK,CACZ,MAAO,SACP,KAAMH,EAAU,YAAY,IAAI,CAAC,CAAA,CAAGI,CAAC,IAAMA,CAAC,EAC5C,YAAaV,EAAU,OACvB,YAAa,EACb,YAAa,CAAA,CACd,EAGC,MAAM,QAAQO,CAAI,GAAKA,EAAK,QAC9BE,EAAS,KACP,GAAGF,EAAK,IAAKI,IAAO,CAClB,MAAOA,EAAE,MACT,MAAO,MAAM,QAAQA,EAAE,IAAI,EAAIA,EAAE,KAAO,CAAA,GAAI,IAAI,CAAC,CAAA,CAAGD,CAAC,IAAMA,CAAC,EAC5D,YAAaC,EAAE,MAAM,cAAc,SAAS,MAAM,EAAIX,EAAU,KAAOA,EAAU,KACjF,YAAa,EACb,YAAa,CAAA,EACb,CAAA,EAIF,CAACZ,EAAO,QAAU,CAACqB,EAAS,OAC9B,OAAO9C,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,yBAAsB,EAGnE,MAAMiB,EAA0B,CAAE,OAAAQ,EAAQ,SAAAqB,CAAA,EACpC3B,EAAgC,CACpC,WAAY,GACZ,oBAAqB,GACrB,QAAS,CAAE,OAAQ,CAAE,QAAS,EAAA,EAAQ,QAAS,CAAE,QAAS,EAAA,CAAK,CAAE,EAGnE,OACEnB,MAAC,OAAI,aAAW,YACd,eAACiD,EAAA,CAAK,KAAAhC,EAAY,QAAAE,EAAkB,CAAA,CACtC,CAEJ,EAKO,SAAS+B,EAAa,CAC3B,MAAAC,CACF,EAEG,CACD,MAAMC,GAASD,GAAS,CAAA,GACrB,IAAKE,IAAS,CACb,QAASA,EAAI,QAAUA,EAAI,OAAS,IAAI,SAAA,EACxC,KAAM,OAAO,SAASA,EAAI,MAAQA,EAAI,CAAC,EAAI,OAAOA,EAAI,MAAQA,EAAI,CAAC,EAAI,GAAA,EACvE,EACD,OAAQL,GAAMA,EAAE,QAAU,OAAO,SAASA,EAAE,IAAI,CAAC,EAEpD,OACE5B,EAAAA,KAAC,MAAA,CAAI,UAAU,sDACb,SAAA,CAAApB,EAAAA,IAAC,MAAA,CAAI,UAAU,6BAA6B,SAAA,uBAAoB,EAChEoB,EAAAA,KAAC,KAAA,CAAG,UAAU,YACX,SAAA,CAAAgC,EAAM,IAAI,CAACE,EAAGtC,IACbI,OAAC,KAAA,CAAW,UAAU,4CACpB,SAAA,CAAApB,EAAAA,IAAC,OAAA,CAAK,UAAU,gBAAiB,SAAAsD,EAAE,OAAO,EAC1ClC,EAAAA,KAAC,OAAA,CAAK,UAAU,YAAc,SAAA,EAAAkC,EAAE,KAAO,KAAK,QAAQ,CAAC,EAAE,GAAA,CAAA,CAAC,CAAA,CAAA,EAFjDtC,CAGT,CACD,EACAoC,EAAM,SAAW,SACf,KAAA,CAAG,UAAU,wBAAwB,SAAA,0BAAA,CAAwB,CAAA,CAAA,CAElE,CAAA,EACF,CAEJ,CAgBO,SAASG,EAAqB,CACnC,SAAAZ,EACA,WAAAa,EAAa,CAAC,KAAO,EAAG,IAAM,EAAG,EACjC,GAAAC,EACA,gBAAAC,CACF,EAUG,WACD,MAAMC,GAAmBC,EAAAjB,GAAA,YAAAA,EAAU,YAAV,YAAAiB,EAAqB,aACxCC,GAA2BC,EAAAnB,GAAA,YAAAA,EAAU,YAAV,YAAAmB,EAAqB,eAEhDC,IACJC,EAAAL,GAAA,YAAAA,EAAmB,KAAnB,YAAAK,EAAuB,UACtB,OAAO,SAASrB,GAAA,YAAAA,EAAU,YAAY,EAAKA,EAAU,aAA0B,EAAI,GAEtF,GAAI,CAACoB,EACH,OAAO/D,EAAAA,IAAC,MAAA,CAAI,UAAU,qBAAqB,SAAA,6CAA0C,EAGvF,MAAMyB,EAAS,MAAM,KAAK,CAAE,OAAQsC,CAAA,EAAK,CAAC7C,EAAGF,IAAM,IAAIA,CAAC,EAAE,EACpDiD,EACJ,OAAOR,GAAO,SACVA,EACA,MAAM,QAAQd,GAAA,YAAAA,EAAU,WAAW,GAAKA,EAAU,YAAY,OAC9DA,EAAU,YAAY,CAAC,EAAE,CAAC,EAC1B,OAEAuB,EACJL,GAA4BA,EAAyB,QAAU,OAAOI,GAAO,SACzEJ,EAAyB,IAAKM,GAAQA,EAAMF,EAAK,CAAC,EAClDT,EAEAY,EAAsBV,IAAoB,CAACW,EAAYC,IAAoB,GAE3EC,EACJZ,GAAoBA,EAAiB,OACjCA,EACA,OAAOM,GAAO,SACdC,EAAc,IAAKM,GACjB,MAAM,KAAK,CAAE,OAAQT,CAAA,EAAK,CAAC7C,EAAG2B,IAAMuB,EAAoBvB,GAAI,EAAI2B,GAAMP,CAAE,CAAC,CAAA,EAE3EC,EAAc,IAAI,IAAM,MAAM,KAAK,CAAE,OAAQH,CAAA,EAAK,IAAM,CAAC,CAAC,EAE1DU,EAAU,CAAC,UAAW,UAAW,UAAW,SAAS,EACrD3B,EAAWyB,EAAW,IAAI,CAACG,EAAQ1D,KAAO,CAC9C,MAAO,SAAS,KAAK,MAAMkD,EAAclD,CAAC,EAAI,GAAG,CAAC,IAClD,KAAM0D,EACN,YAAaD,EAAQzD,EAAIyD,EAAQ,MAAM,EACvC,YAAa,EACb,YAAa,EACb,QAAS,GAAA,EACT,EAEIxD,EAA0B,CAAE,OAAAQ,EAAQ,SAAAqB,CAAA,EACpC3B,EAAgC,CACpC,WAAY,GACZ,oBAAqB,GACrB,OAAQ,CACN,EAAG,CAAE,KAAM,CAAE,QAAS,EAAA,EAAS,MAAO,CAAE,YAAa,CAAA,EAAK,MAAO,CAAE,QAAS,GAAM,KAAM,OAAO,EAC/F,EAAG,CAAE,IAAK,EAAG,IAAK,EAAG,MAAO,CAAE,QAAS,GAAM,KAAM,aAAA,CAAc,CAAE,EAErE,QAAS,CAAE,OAAQ,CAAE,QAAS,EAAA,EAAQ,QAAS,CAAE,QAAS,GAAK,EAC/D,SAAU,CAAE,KAAM,CAAE,KAAM,GAAM,CAAE,EAGpC,OACEnB,EAAAA,IAAC,MAAA,CAAI,UAAU,kBAAkB,MAAO,CAAE,OAAQ,GAAA,EAChD,SAAAA,EAAAA,IAACiD,EAAA,CAAK,KAAAhC,EAAY,QAAAE,EAAkB,EACtC,CAEJ"}