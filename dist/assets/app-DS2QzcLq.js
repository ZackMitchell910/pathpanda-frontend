import{C as H,r as c,R as J,L as ot,B as it,a as ee,P as te,p as se,b as ae,c as ne,d as re,i as oe,j as e,e as lt,A as Te,T as ct,S as dt,D as ut,F as mt,z as W}from"./vendor-DU_cM-V4.js";const Be="label";function Ie(a,t){typeof a=="function"?a(t):a&&(a.current=t)}function pt(a,t){const r=a.options;r&&t&&Object.assign(r,t)}function Re(a,t){a.labels=t}function Fe(a,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Be;const n=[];a.datasets=t.map(o=>{const d=a.datasets.find(b=>b[r]===o[r]);return!d||!o.data||n.includes(d)?{...o}:(n.push(d),Object.assign(d,o),d)})}function ht(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Be;const r={labels:[],datasets:[]};return Re(r,a.labels),Fe(r,a.datasets,t),r}function bt(a,t){const{height:r=150,width:n=300,redraw:o=!1,datasetIdKey:d,type:b,data:u,options:l,plugins:x=[],fallbackContent:f,updateMode:j,...I}=a,g=c.useRef(null),h=c.useRef(null),y=()=>{g.current&&(h.current=new H(g.current,{type:b,data:ht(u,d),options:l&&{...l},plugins:x}),Ie(t,h.current))},N=()=>{Ie(t,null),h.current&&(h.current.destroy(),h.current=null)};return c.useEffect(()=>{!o&&h.current&&l&&pt(h.current,l)},[o,l]),c.useEffect(()=>{!o&&h.current&&Re(h.current.config.data,u.labels)},[o,u.labels]),c.useEffect(()=>{!o&&h.current&&u.datasets&&Fe(h.current.config.data,u.datasets,d)},[o,u.datasets]),c.useEffect(()=>{h.current&&(o?(N(),setTimeout(y)):h.current.update(j))},[o,l,u.labels,u.datasets,j]),c.useEffect(()=>{h.current&&(N(),setTimeout(y))},[b]),c.useEffect(()=>(y(),()=>N()),[]),J.createElement("canvas",{ref:g,role:"img",height:r,width:n,...I},f)}const xt=c.forwardRef(bt);function De(a,t){return H.register(t),c.forwardRef((r,n)=>J.createElement(xt,{...r,ref:n,type:a}))}const ie=De("line",ot),le=De("bar",it);async function gt(a,t){const r=a.getReader();let n;for(;!(n=await r.read()).done;)t(n.value)}function ft(a){let t,r,n,o=!1;return function(b){t===void 0?(t=b,r=0,n=-1):t=jt(t,b);const u=t.length;let l=0;for(;r<u;){o&&(t[r]===10&&(l=++r),o=!1);let x=-1;for(;r<u&&x===-1;++r)switch(t[r]){case 58:n===-1&&(n=r-l);break;case 13:o=!0;case 10:x=r;break}if(x===-1)break;a(t.subarray(l,x),n),l=r,n=-1}l===u?t=void 0:l!==0&&(t=t.subarray(l),r-=l)}}function yt(a,t,r){let n=Oe();const o=new TextDecoder;return function(b,u){if(b.length===0)r?.(n),n=Oe();else if(u>0){const l=o.decode(b.subarray(0,u)),x=u+(b[u+1]===32?2:1),f=o.decode(b.subarray(x));switch(l){case"data":n.data=n.data?n.data+`
`+f:f;break;case"event":n.event=f;break;case"id":a(n.id=f);break;case"retry":const j=parseInt(f,10);isNaN(j)||t(n.retry=j);break}}}}function jt(a,t){const r=new Uint8Array(a.length+t.length);return r.set(a),r.set(t,a.length),r}function Oe(){return{data:"",event:"",id:"",retry:void 0}}var vt=function(a,t){var r={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&t.indexOf(n)<0&&(r[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(a);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(a,n[o])&&(r[n[o]]=a[n[o]]);return r};const G="text/event-stream",wt=1e3,$e="last-event-id";function Nt(a,t){var{signal:r,headers:n,onopen:o,onmessage:d,onclose:b,onerror:u,openWhenHidden:l,fetch:x}=t,f=vt(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((j,I)=>{const g=Object.assign({},n);g.accept||(g.accept=G);let h;function y(){h.abort(),document.hidden||C()}l||document.addEventListener("visibilitychange",y);let N=wt,A=0;function v(){document.removeEventListener("visibilitychange",y),window.clearTimeout(A),h.abort()}r?.addEventListener("abort",()=>{v(),j()});const O=x??window.fetch,$=o??_t;async function C(){var S;h=new AbortController;try{const T=await O(a,Object.assign(Object.assign({},f),{headers:g,signal:h.signal}));await $(T),await gt(T.body,ft(yt(E=>{E?g[$e]=E:delete g[$e]},E=>{N=E},d))),b?.(),v(),j()}catch(T){if(!h.signal.aborted)try{const E=(S=u?.(T))!==null&&S!==void 0?S:N;window.clearTimeout(A),A=window.setTimeout(C,E)}catch(E){v(),I(E)}}}C()})}function _t(a){const t=a.headers.get("content-type");if(!t?.startsWith(G))throw new Error(`Expected content-type to be ${G}, Actual: ${t}`)}H.register(ee,te,se,ae,ne,re,oe);const St=({data:a})=>{const t=a.median_path.map(([o])=>`D${o}`),r=o=>o.map(([,d])=>d),n=[{label:"95% Low",data:r(a.bands.p95_low),borderColor:"rgba(0,0,0,0)",backgroundColor:"rgba(59,130,246,0.08)",fill:"+1",pointRadius:0,tension:.25,order:1},{label:"95% High",data:r(a.bands.p95_high),borderColor:"rgba(0,0,0,0)",backgroundColor:"rgba(59,130,246,0.08)",fill:!1,pointRadius:0,tension:.25,order:1},{label:"80% Low",data:r(a.bands.p80_low),borderColor:"rgba(0,0,0,0)",backgroundColor:"rgba(59,130,246,0.16)",fill:"+1",pointRadius:0,tension:.25,order:2},{label:"80% High",data:r(a.bands.p80_high),borderColor:"rgba(0,0,0,0)",backgroundColor:"rgba(59,130,246,0.16)",fill:!1,pointRadius:0,tension:.25,order:2},{label:"Median",data:r(a.median_path),borderColor:"#9FE88D",backgroundColor:"rgba(159,232,141,0.15)",pointRadius:0,tension:.25,order:3}];return e.jsx("div",{className:"w-full h-[360px]",children:e.jsx(ie,{data:{labels:t,datasets:n},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,normalized:!0,interaction:{mode:"nearest",intersect:!1},plugins:{legend:{display:!0,labels:{color:"#cbd5e1",boxWidth:12,usePointStyle:!0}},tooltip:{enabled:!0,intersect:!1,displayColors:!1,callbacks:{title:o=>o[0]?.label??""}}},scales:{x:{grid:{color:"rgba(148,163,184,0.1)"},ticks:{color:"#94a3b8",maxTicksLimit:12}},y:{grid:{color:"rgba(148,163,184,0.1)"},ticks:{color:"#94a3b8"}}}}})})};function F({title:a,children:t}){return e.jsxs("div",{className:"rounded-2xl bg-[#0E141C] border border-[#1B2431] p-4",children:[a&&e.jsx("div",{className:"text-sm font-semibold text-gray-300 mb-2",children:a}),t]})}function kt({symbol:a,items:t,loading:r,error:n,nextCursor:o,onLoadMore:d}){const b=t.length?t.reduce((l,x)=>l+(x.sentiment??0),0)/t.length:0,u=b>.05?"text-emerald-400":b<-.05?"text-rose-400":"text-gray-300";return e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"rounded-2xl border border-[#1B2431] bg-[#0E141C]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-[#1B2431] rounded-t-2xl bg-[#131A23]",children:[e.jsxs("span",{className:"font-medium",children:["News — ",a||"—"]}),t.length>0&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Avg sentiment ",e.jsxs("strong",{className:u,children:[(b*100).toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"p-4",children:[n&&e.jsxs("div",{className:"text-xs text-rose-400 mb-2",children:["Error: ",n]}),r&&t.length===0?e.jsx(Ct,{}):t.length===0?e.jsx("div",{className:"text-xs text-gray-400",children:"No recent articles found."}):e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:t.map(l=>e.jsxs("li",{className:"flex gap-3 p-2 rounded-lg bg-[#0A111A] border border-[#1B2431]",children:[l.image_url?e.jsx("img",{src:l.image_url,alt:"",className:"w-16 h-16 object-cover rounded-md flex-shrink-0",loading:"lazy"}):e.jsx("div",{className:"w-16 h-16 bg-[#121923] rounded-md flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("a",{href:l.url,target:"_blank",rel:"noreferrer",className:"font-medium hover:underline line-clamp-2",title:l.title,children:l.title}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-400 whitespace-nowrap overflow-hidden text-ellipsis",children:[e.jsx("span",{children:l.source??"—"}),e.jsxs("span",{children:[" ","•"," ",l.published_at?new Date(l.published_at).toLocaleString():"—"]}),typeof l.sentiment=="number"&&e.jsxs("span",{className:l.sentiment>.05?"ml-2 text-emerald-400":l.sentiment<-.05?"ml-2 text-rose-400":"ml-2 text-gray-400",children:[(l.sentiment*100).toFixed(0),"%"]})]})]})]},l.id??l.url))}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[d&&o&&e.jsx("button",{onClick:d,className:"px-3 py-1.5 rounded bg-[#131A23] border border-[#1B2431] text-sm",disabled:r,children:r?"Loading…":"Load more"}),r&&t.length>0&&e.jsx(At,{})]})]})]})})}function Ct(){return e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Array.from({length:4}).map((a,t)=>e.jsxs("li",{className:"flex gap-3 p-2 rounded-lg bg-[#0A111A] border border-[#1B2431]",children:[e.jsx("div",{className:"w-16 h-16 rounded-md bg-[#121923] animate-pulse"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-[#121923] rounded animate-pulse w-5/6"}),e.jsx("div",{className:"h-3 bg-[#121923] rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-3 bg-[#121923] rounded animate-pulse w-1/2"})]})]},t))})}function At(){return e.jsxs("span",{className:"inline-flex gap-1 items-center text-xs text-gray-400",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 animate-bounce"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 animate-bounce [animation-delay:0.1s]"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400 animate-bounce [animation-delay:0.2s]"})]})}function Et({symbol:a,includeNews:t,limit:r=6,days:n=7,getApiKey:o,log:d=()=>{}}){const[b,u]=c.useState([]),[l,x]=c.useState(null),[f,j]=c.useState(!1),[I,g]=c.useState(null);return c.useEffect(()=>{let y=!1;const N=new AbortController;return t?(u([]),x(null),g(null),j(!0),(async()=>{const A=o();if(!A){j(!1),g("Missing API key"),d("Error: Please enter a valid API key");return}try{const v=`/api/news/${encodeURIComponent(a)}?limit=${r}&days=${n}`,O=await fetch(v,{headers:{"X-API-Key":A},signal:N.signal});if(!O.ok)throw new Error(String(O.status));const $=await O.json(),C=Array.isArray($)?{items:$,next_cursor:null}:$;if(y)return;u(C.items??[]),x(C.next_cursor??null);const S=C.items?.length??0?C.items.reduce((T,E)=>T+(E.sentiment??0),0)/C.items.length:0;d(`News loaded: ${C.items?.length??0} — est. sentiment ${(S*100).toFixed(1)}%`)}catch(v){y||(g(v?.message||"News fetch failed"),d(`News fetch error: ${v?.message||v}`))}finally{y||j(!1)}})(),()=>{y=!0,N.abort()}):(u([]),x(null),j(!1),g(null),()=>{y=!0,N.abort()})},[a,t,r,n,o,d]),{items:b,nextCursor:l,loading:f,error:I,loadMore:async()=>{if(!l)return;const y=o();if(!y){g("Missing API key");return}try{j(!0);const N=`/api/news/${encodeURIComponent(a)}?limit=${r}&days=${n}&cursor=${encodeURIComponent(l)}`,A=await fetch(N,{headers:{"X-API-Key":y}});if(!A.ok)throw new Error(String(A.status));const v=await A.json();u(O=>{const $=new Set(O.map(S=>S.id??S.url)),C=(v.items??[]).filter(S=>!$.has(S.id??S.url));return[...O,...C]}),x(v.next_cursor??null)}catch(N){g(N?.message||"News fetch failed"),d(`News fetch error: ${N?.message||N}`)}finally{j(!1)}}}}H.register(ee,te,lt,Te,se,ae,ne,re,oe,ct,dt);function Le(a){return a.median_path.map(([t])=>`D${t}`)}function Me(a){return Math.max(0,Math.min(1,a))}const Pt=({pathsTerminal:a,ptiles:t})=>{const r=Math.min(40,Math.max(10,Math.floor(Math.sqrt(a.length)))),n=Math.min(...a),d=(Math.max(...a)-n)/r||1,b=new Array(r).fill(0);for(const h of a){const y=Math.min(r-1,Math.max(0,Math.floor((h-n)/d)));b[y]++}const u=b.map((h,y)=>(n+y*d).toFixed(2)),l=b.map(h=>h/a.length),x=[];let f=0;for(const h of l)f+=h,x.push(f);const j={labels:u,datasets:[{type:"bar",label:"PDF (terminal)",data:l,borderWidth:0},{type:"line",label:"CDF (terminal)",data:x,borderWidth:2,tension:.2,yAxisID:"y1"}]},I={responsive:!0,interaction:{mode:"index",intersect:!1},scales:{y:{beginAtZero:!0,title:{display:!0,text:"PDF"}},y1:{beginAtZero:!0,position:"right",max:1,title:{display:!0,text:"CDF"}},x:{ticks:{maxRotation:0}}},plugins:{legend:{display:!0},tooltip:{enabled:!0}}},g=e.jsxs("div",{className:"text-xs mt-2 grid grid-cols-3 gap-2",children:[t?.p05!=null&&e.jsxs("div",{children:["p05: ",t.p05.toFixed(2)]}),t?.p50!=null&&e.jsxs("div",{children:["p50: ",t.p50.toFixed(2)]}),t?.p95!=null&&e.jsxs("div",{children:["p95: ",t.p95.toFixed(2)]})]});return e.jsxs("div",{className:"p-4 rounded-2xl shadow-lg bg-gray-900 text-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Terminal Distribution (PDF + CDF)"}),e.jsx(le,{data:j,options:I}),g]})},It=({artifact:a,thresholds:t,thresholdsAbs:r=!1,S0:n,pathMatrixAbove:o})=>{const d=Le(a),u=(r?t:t.map(f=>n*(1+f))).map((f,j)=>({label:r?`Pr(S_t ≥ ${f.toFixed(2)})`:`Pr(S_t ≥ ${(100*t[j]).toFixed(0)}%)`,data:d.map((I,g)=>Me(o(g,f))),borderWidth:2,tension:.25,fill:!1})),l={labels:d,datasets:u},x={responsive:!0,scales:{y:{min:0,max:1,ticks:{callback:f=>`${Math.round(100*f)}%`}}},plugins:{legend:{display:!0}}};return e.jsxs("div",{className:"p-4 rounded-2xl shadow-lg bg-gray-900 text-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Hit Probabilities by Day"}),e.jsx(ie,{data:l,options:x})]})},Ot=({probs:a})=>{const t={labels:a.map(n=>n.label),datasets:[{label:"Pr at Horizon",data:a.map(n=>Me(n.p)),borderWidth:1}]},r={indexAxis:"y",responsive:!0,scales:{x:{min:0,max:1,ticks:{callback:n=>`${Math.round(100*n)}%`}}},plugins:{legend:{display:!1}}};return e.jsxs("div",{className:"p-4 rounded-2xl shadow-lg bg-gray-900 text-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Target Ladder (Horizon Odds)"}),e.jsx(le,{data:t,options:r})]})},$t=({artifact:a,reps:t})=>{const r=Le(a),n={responsive:!0,scales:{y:{beginAtZero:!1}},plugins:{legend:{display:!1}},elements:{point:{radius:0}}};return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:t.map(o=>e.jsxs("div",{className:"p-4 rounded-2xl shadow-lg bg-gray-900 text-gray-100",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:o.label}),e.jsx(ie,{data:{labels:r,datasets:[{data:o.path.map(([,d])=>d),borderWidth:2}]},options:n})]},o.label))})},Tt=({drivers:a})=>{const t={labels:a.map(n=>n.name),datasets:[{label:"Contribution",data:a.map(n=>n.weight),borderWidth:1}]},r={responsive:!0,scales:{y:{grid:{drawBorder:!1}},x:{grid:{display:!1}}},plugins:{legend:{display:!1}}};return e.jsxs("div",{className:"p-4 rounded-2xl shadow-lg bg-gray-900 text-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Key Drivers"}),e.jsx(le,{data:t,options:r})]})};H.register(ee,te,se,ae,ne,re,oe,ut,Te);function Mt(){const a=()=>{const s=localStorage.getItem("theme");return s==="light"||s==="dark"?s:"dark"},[t,r]=c.useState(a),[n,o]=c.useState("NVDA"),[d,b]=c.useState(""),[u,l]=c.useState(2e3),[x,f]=c.useState(!0),[j,I]=c.useState(!0),[g,h]=c.useState(!0),[y,N]=c.useState(""),A=c.useRef(localStorage.getItem("apiKey")||""),[v,O]=c.useState(""),[$,C]=c.useState(!1),S=()=>v||A.current||"",[T,E]=c.useState(!1),[X,ce]=c.useState(!1);c.useEffect(()=>{v&&localStorage.setItem("apiKey",v)},[v]);const[Bt,ze]=c.useState(""),[de,ue]=c.useState([]),[He,me]=c.useState([]),[pe,he]=c.useState(0),[i,be]=c.useState(null),[Rt,xe]=c.useState(0),[Ft,ge]=c.useState(null),[fe,Ke]=c.useState(!1),[ye,je]=c.useState(!1),[ve,Ue]=c.useState(!localStorage.getItem("onboardingSeen")),K=c.useRef(null),L=typeof d=="number"?d:null,[Dt,We]=c.useState(()=>{try{const s=localStorage.getItem("pp_runs");return s?JSON.parse(s):[]}catch{return[]}}),[U,we]=c.useState("risk");c.useEffect(()=>{localStorage.setItem("theme",t),document.documentElement.className=t==="dark"?"dark":""},[t]),c.useEffect(()=>{K.current&&(K.current.scrollTop=K.current.scrollHeight)},[de]),c.useEffect(()=>{if(ve){const s=setTimeout(()=>{localStorage.setItem("onboardingSeen","true"),Ue(!1)},1e4);return()=>clearTimeout(s)}},[ve]);const{items:Je,nextCursor:Xe,loading:Ve,error:qe,loadMore:Ze}=Et({symbol:n,includeNews:g,getApiKey:S,log:_});function _(s){ue(m=>[...m,s].slice(-50))}const V=s=>s&&s.length?s[s.length-1][1]:void 0,Qe=i?.terminal_prices??[],Ne=i?.var_es?.var95??0,_e=i?.var_es?.es95??0,q=i?.median_path?.[0]?.[1]??0,Z=()=>e.jsxs("svg",{className:"animate-spin h-4 w-4 text-[#9FB3C8]",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-20",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-90",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),Q="px-4 py-2 rounded-xl bg-[#1F2937] border border-[#273445] hover:bg-[#1B2431] disabled:opacity-60 disabled:cursor-not-allowed",Ye=(s,m)=>{const p=i?.hit_probs;if(!p)return 0;let w=0,P=1/0;return p.thresholds_abs.forEach((R,B)=>{const k=Math.abs(R-m);k<P&&(P=k,w=B)}),p.probs_by_day?.[w]?.[s]??0},Se=J.useMemo(()=>{const s=i?.hit_probs;if(!s)return[];const m=i?.median_path?.length?i.median_path.length-1:0,p=["-5%","0%","+5%","+10%"];return s.thresholds_abs.map((w,P)=>({label:p[P]??`${Math.round((w/(q||1)-1)*100)}%`,p:s.probs_by_day?.[P]?.[m]??0}))},[i,q]),Ge=i?[{label:"Bear (≈p05)",path:i.bands.p95_low},{label:"Base (p50)",path:i.median_path},{label:"Bull (≈p95)",path:i.bands.p95_high}]:[],M=s=>{console.log(`Exporting chart: ${s}`)},Y=J.useMemo(()=>{const s=Math.max(0,Math.min(1,pe||0)),m=Math.round(s*100),p=s>.51?"text-[#34D399]":s<.49?"text-[#F87171]":"text-[#FBBF24]",w=s>.51?"Bullish":s<.49?"Bearish":"Neutral";return{v:s,pct:m,color:p,label:w}},[pe]),ke=()=>e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-lg bg-[#111827] border border-[#1B2431] ${Y.color}`,children:[e.jsxs("span",{className:"font-semibold",children:[Y.pct,"%"]}),e.jsx("span",{className:"text-xs text-gray-300",children:Y.label})]}),Ce=s=>(Number.isFinite(s)?s:0).toLocaleString(void 0,{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}),Ae=s=>s<0?"text-[#F87171]":"text-[#34D399]",z=s=>{console.log(`Sharing chart: ${s}`)},Ee=s=>({"Content-Type":"application/json","X-API-Key":s});async function et(s){try{const m=await fetch("/outcomes/label",{method:"POST",headers:Ee(s)});if(!m.ok)throw new Error(await m.text());const p=await m.json();W.success(`Labeled ${p.labeled??0} outcomes`),console.log("Label outcomes:",p)}catch(m){W.error(`Labeling failed: ${m.message||m}`)}}async function tt(s,m){try{const p=await fetch("/learn/online",{method:"POST",headers:Ee(s),body:JSON.stringify({symbol:m,steps:50,batch:32})});if(!p.ok)throw new Error(await p.text());const w=await p.json();W.success(`Online learn OK — w[0]=${w.model?.coef?.[0]?.toFixed(3)??"?"}`),console.log("Online learn:",w)}catch(p){W.error(`Online learn failed: ${p.message||p}`)}}async function st(){const s=S();if(!s){_("Error: Please enter a valid API key");return}if(L==null){_("Error: Please enter a horizon (days).");return}if(L>365){_("Error: Horizon must be ≤ 365 days.");return}je(!0),ue([]),be(null),xe(0),me([]),he(0),ge(null);const m={"Content-Type":"application/json","X-API-Key":s};try{const p={symbol:n.toUpperCase(),horizon_days:Number(L),n_paths:Number(u),timespan:"day",include_news:!!g,include_options:!!x,include_futures:!!j};y.trim()&&(p.x_handles=y.trim());const w=await fetch("/simulate",{method:"POST",headers:m,body:JSON.stringify(p)});if(!w.ok){const k=await w.text();throw new Error(`HTTP ${w.status} – ${k}`)}const{run_id:P}=await w.json();ze(P),_(`Queued run_id: ${P}`),await Nt(`/simulate/${P}/stream`,{headers:m,onopen:async k=>{if(!k.ok)throw new Error(`HTTP ${k.status}`);_("Connected to stream")},onmessage:k=>{try{const D=JSON.parse(k.data);if(typeof D.status=="string"){const Pe=typeof D.progress=="number"?D.progress:0;xe(Pe),_(`Status: ${D.status} | Progress: ${Math.round(Pe)}%`)}}catch{}},onerror:k=>{throw k},onclose:()=>_("Stream closed.")});const R=await fetch(`/simulate/${P}/artifact`,{headers:m});if(!R.ok){const k=await R.text();throw new Error(`Artifact fetch failed: ${R.status} – ${k}`)}const B=await R.json();be(B),me(B.drivers||[]),he(B.prob_up_end||0),ge(B.spot??B.median_path?.[0]?.[1]??null),We(k=>{const D=[{id:P,symbol:n,horizon:L??0,n_paths:u,finishedAt:new Date().toISOString(),q50:B.bands.p50?.[B.bands.p50.length-1]?.[1]??null,probUp:B.prob_up_end??null},...k].slice(0,20);try{localStorage.setItem("pp_runs",JSON.stringify(D))}catch{}return D})}catch(p){_(`Error: ${p.message??p}`)}finally{je(!1)}}async function at(){const s=S();if(!s){_("Error: Please enter a valid API key");return}E(!0),_("Training model...");try{const p=await fetch("/train",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":s},body:JSON.stringify({symbol:n,lookback_days:180})});if(!p.ok){const w=await p.text();throw new Error(`Train failed: ${p.status} – ${w}`)}_("Model trained successfully.")}catch(m){_(`Error: ${m.message??m}`)}finally{E(!1)}}async function nt(){const s=S();if(!s){_("Error: Please enter a valid API key");return}ce(!0),_("Running prediction...");try{const w=await fetch("/predict",{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":s},body:JSON.stringify({symbol:n,horizon_days:typeof d=="number"?d:30})});if(!w.ok){const R=await w.text();throw new Error(`Predict failed: ${w.status} – ${R}`)}const P=await w.json();_(`Prediction: Prob Up Next = ${(P.prob_up_next*100).toFixed(2)}%`)}catch(m){_(`Error: ${m.message??m}`)}finally{ce(!1)}}function rt(){if(!i)return;const s=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),m=URL.createObjectURL(s),p=document.createElement("a");p.href=m,p.download=`mc_${i.symbol}_${i.horizon_days}d.json`,p.click(),URL.revokeObjectURL(m)}return e.jsxs("div",{className:"min-h-screen bg-[#0A0F17] text-[#F9F8F3] font-sans",children:[e.jsx(mt,{position:"bottom-right"}),e.jsxs("main",{className:"max-w-6xl mx-auto p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Symbol"}),e.jsx("input",{className:"w-full mt-1 px-3 py-2 rounded-xl bg-[#131A23] border border-[#1B2431] outline-none",value:n,onChange:s=>o(s.target.value.toUpperCase()),placeholder:"NVDA"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Horizon (days)"}),e.jsx("input",{type:"number",className:"w-full mt-1 px-3 py-2 rounded-xl bg-[#131A23] border border-[#1B2431] outline-none",value:d,onChange:s=>b(s.target.valueAsNumber||""),placeholder:"30",min:1,max:365})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400",children:"Paths"}),e.jsx("input",{type:"number",className:"w-full mt-1 px-3 py-2 rounded-xl bg-[#131A23] border border-[#1B2431] outline-none",value:u,onChange:s=>l(s.target.valueAsNumber),min:100,step:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400",children:"API Key"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:$?"text":"password",className:"w-full px-3 py-2 rounded-xl bg-[#131A23] border border-[#1B2431] outline-none",value:v||A.current,onChange:s=>O(s.target.value),placeholder:"sk-..."}),e.jsx("button",{onClick:()=>C(s=>!s),className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-400",children:$?"Hide":"Show"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:s=>f(s.target.checked)}),"Include Options"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:s=>I(s.target.checked)}),"Include Futures"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:s=>h(s.target.checked)}),"Include News"]}),e.jsx("button",{onClick:()=>Ke(s=>!s),className:"ml-auto px-3 py-2 rounded-xl bg-[#131A23] border border-[#1B2431]",children:fe?"Hide Advanced":"Advanced"})]}),fe&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-xs text-gray-400",children:"X handles (comma-sep)"}),e.jsx("input",{className:"w-full mt-1 px-3 py-2 rounded-xl bg-[#131A23] border border-[#1B2431] outline-none",value:y,onChange:s=>N(s.target.value),placeholder:"@elonmusk,@business"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[e.jsx("button",{onClick:st,disabled:ye||!n||!L||!u,className:Q,children:ye?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Z,{})," Running…"]}):"Run Simulation"}),e.jsx("button",{onClick:at,disabled:T,className:Q,"aria-busy":T,children:T?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Z,{})," Training…"]}):"Train"}),e.jsx("button",{onClick:nt,disabled:X,className:Q,"aria-busy":X,children:X?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(Z,{})," Predicting…"]}):"Predict"}),e.jsx("button",{onClick:rt,disabled:!i,className:"px-4 py-2 rounded-xl bg-[#131A23] border border-[#1B2431] disabled:opacity-60",children:"Export Artifact"}),e.jsx("div",{className:"ml-auto",children:e.jsx(ke,{})})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{className:"px-3 py-2 rounded bg-emerald-600 text-white disabled:opacity-60",onClick:()=>et(v),disabled:!v,children:"Label Outcomes (Now)"}),e.jsx("button",{className:"px-3 py-2 rounded bg-indigo-600 text-white disabled:opacity-60",onClick:()=>tt(v,n),disabled:!v,children:"Online Learn"})]}),e.jsx("div",{ref:K,className:"text-xs bg-[#0E141C] border border-[#1B2431] rounded-xl p-3 h-28 overflow-auto mb-6",children:de.map((s,m)=>e.jsx("div",{className:"text-gray-300",children:s},m))}),g&&e.jsx(kt,{symbol:n,items:Je,loading:Ve,error:qe,nextCursor:Xe,onLoadMore:Ze}),i&&e.jsx("div",{className:"sticky top-0 z-10 -mx-6 px-6 py-3 bg-[#0A0F17]/70 backdrop-blur border-b border-[#121923] mb-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(F,{title:"Probability Up",children:e.jsx("div",{className:"min-h-[72px] flex items-center",children:e.jsx(ke,{})})}),e.jsx(F,{title:"Risk",children:e.jsxs("div",{className:"min-h-[72px] text-sm leading-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"VaR 95%:"})," ",e.jsx("span",{className:Ae(Ne),children:Ce(Ne)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"ES 95%:"})," ",e.jsx("span",{className:Ae(_e),children:Ce(_e)})]})]})}),e.jsx(F,{title:"Horizon Odds",children:e.jsx("div",{className:"min-h-[72px]",children:Se.length?e.jsx(Ot,{probs:Se}):e.jsx("div",{className:"text-xs text-gray-400",children:"Run a simulation to see horizon odds."})})})]})}),i&&e.jsx("div",{className:"mb-6",children:e.jsxs(F,{title:"Fan Chart",children:[e.jsx(St,{data:{symbol:i.symbol,median_path:i.median_path,bands:{p50:i.bands.p50,p80_low:i.bands.p80_low,p80_high:i.bands.p80_high,p95_low:i.bands.p95_low,p95_high:i.bands.p95_high},prob_up_end:i.prob_up_end,horizon_days:i.horizon_days}}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>M("fan"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Export"}),e.jsx("button",{onClick:()=>z("fan"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Share"})]})]})}),i&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex border-b border-[#1B2431] rounded-t-2xl overflow-hidden",children:[e.jsx("button",{className:`px-4 py-2 ${U==="risk"?"bg-[#1F2937]":"bg-[#131A23]"}`,onClick:()=>we("risk"),children:"Risk & Evidence"}),e.jsx("button",{className:`px-4 py-2 ${U==="scenarios"?"bg-[#1F2937]":"bg-[#131A23]"}`,onClick:()=>we("scenarios"),children:"Scenarios & Drivers"})]}),e.jsxs("div",{className:"p-4 bg-[#0E141C] rounded-b-2xl border border-[#1B2431] border-t-0",children:[U==="risk"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(F,{title:"Hit Probability Ribbon",children:[e.jsx(It,{artifact:{symbol:i.symbol,horizon_days:i.horizon_days,median_path:i.median_path,bands:{p05:i.bands.p95_low,p50:i.bands.p50,p95:i.bands.p95_high},prob_up_end:i.prob_up_end,drivers:i.drivers?.map(s=>({name:s.feature,weight:s.weight}))??[]},thresholds:[-.05,0,.05,.1],S0:q,pathMatrixAbove:Ye}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>M("hit"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Export"}),e.jsx("button",{onClick:()=>z("hit"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Share"})]})]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs(F,{title:"Terminal Distribution",children:[e.jsx(Pt,{pathsTerminal:Qe,ptiles:{p05:V(i.bands.p95_low),p50:V(i.bands.p50),p95:V(i.bands.p95_high)}}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>M("terminal"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Export"}),e.jsx("button",{onClick:()=>z("terminal"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Share"})]})]})})]}),U==="scenarios"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(F,{title:"Scenario Tiles",children:[e.jsx($t,{artifact:{symbol:i.symbol,horizon_days:i.horizon_days,median_path:i.median_path,bands:{p05:i.bands.p95_low,p50:i.bands.p50,p95:i.bands.p95_high},prob_up_end:i.prob_up_end,drivers:i.drivers?.map(s=>({name:s.feature,weight:s.weight}))??[]},reps:Ge}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>M("scenarios"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Export"}),e.jsx("button",{onClick:()=>z("scenarios"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Share"})]})]})}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs(F,{title:"Drivers",children:[e.jsx(Tt,{drivers:He.map(s=>({name:s.feature,weight:s.weight}))}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>M("drivers"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Export"}),e.jsx("button",{onClick:()=>z("drivers"),className:"px-2 py-1 rounded bg-[#131A23] border border-[#1B2431]",children:"Share"})]})]})})]})]})]})]})]})}export{Mt as A};
